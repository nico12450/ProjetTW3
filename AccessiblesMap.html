<!doctype html>
<html lang="en">
  <head>
	<meta style = "utf-8">
    <link rel="stylesheet" href="https://openlayers.org/en/v4.0.1/css/ol.css" type="text/css">
    <style>
      .map {
        height: 100%;
        width: 100%;
      }
    </style>
    <script src="https://openlayers.org/en/v4.0.1/build/ol.js" type="text/javascript"></script>
    <script
  src="https://code.jquery.com/jquery-3.1.1.min.js"
  integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
  crossorigin="anonymous"></script>
    <title>OpenLayers example</title>
  </head>
  <body>
	
    <script type="text/javascript">
	/*
      var map = new ol.Map({
        target: 'map',
        layers: [
          new ol.layer.Tile({
            source: new ol.source.OSM()
          })
        ],
        view: new ol.View({
          center: ol.proj.fromLonLat([2.353579,48.861443]),
          zoom: 20
        })
      });
	  */
	  /*
	var db;
	if(window.openDatabase){
		db = openDatabase('ma_base', '1.0', 'database', 2000000, function(db){
			db.changeVersion('', '1.0', function (t) {
				t.executeSql('CREATE TABLE films (id, nom, geolocalisation)');
			}, error);
		});
		alert(db.version);
	}
	*/
	
	window.indexedDB = window.indexedDB || window.mozIndexedDB || window.webkitIndexedDB || window.msIndexedDB;
	window.IDBTransaction = window.IDBTransaction || window.webkitIDBTransaction || window.msIDBTransaction;
	window.IDBKeyRange = window.IDBKeyRange || window.webkitIDBKeyRange || window.msIDBKeyRange;
	

	
const films = [];
const dbName = "MaBase";
	
var idbSupported = false;
var db;
 
document.addEventListener("DOMContentLoaded", function(){
 
    if("indexedDB" in window) {
        idbSupported = true;
    }
    else{
    	    window.alert("Votre navigateur ne supporte pas une version stable d'IndexedDB. Quelques fonctionnalités ne seront pas disponibles.");
    }
 
    if(idbSupported) {
        var openRequest = indexedDB.open("BaseFilms",3);
 
        openRequest.onupgradeneeded = function(e) {
			console.log("running onupgradeneeded");
			db = e.target.result;

			var table = db.createObjectStore("Films",{autoIncrement: true});
			
			//table.createIndex("nom", "nom", {unique: false});
			//table.createIndex("arrondissement", "arrondissement", {unique: false});

			table.transaction.oncomplete = function(e){

				var tableFilm = db.transaction("Films", "readwrite").objectStore("Films");
        var tableau;

        $.ajax({

         url : 'https://raw.githubusercontent.com/nico12450/ProjetTW3/master/tournagesdefilmsparis2011.json',
         type : 'GET',
         dataType : 'JSON',

         success : function(data, statut){

            tableau = $.parseJSON(JSON.stringify(data));

         },

         error : function(resultat, statut, erreur){
            console.log(erreur);
         },

         complete : function(resultat, statut){
            console.log("tableau de données créé");
            ajoutFilm(tableFilm,tableau);
         }

        });

			}

		}
 
        openRequest.onsuccess = function(e) {
            console.log("Succès");
            db = e.target.result;
        }
 
        openRequest.onerror = function(e) {
            console.log("Erreur");
            console.dir(e);
        }
 
    }
 
},false);

function ajoutFilm(tf,tab){
  for (var i = 0; i<tab.length; i++) {
      tf.add(tab[i].fields);
  };
}

	

    </script>
  </body>
</html>
<!doctype html>
<html lang="en">
  <head>
	<meta style = "utf-8">
    <link rel="stylesheet" href="https://openlayers.org/en/v4.0.1/css/ol.css" type="text/css">
    <style>
      .map {
        height: 100%;
        width: 100%;
      }
    </style>
    <script src="https://openlayers.org/en/v4.0.1/build/ol.js" type="text/javascript"></script>
    <title>OpenLayers example</title>
  </head>
  <body>
	
    <script type="text/javascript">
	/*
      var map = new ol.Map({
        target: 'map',
        layers: [
          new ol.layer.Tile({
            source: new ol.source.OSM()
          })
        ],
        view: new ol.View({
          center: ol.proj.fromLonLat([2.353579,48.861443]),
          zoom: 20
        })
      });
	  */
	  /*
	var db;
	if(window.openDatabase){
		db = openDatabase('ma_base', '1.0', 'database', 2000000, function(db){
			db.changeVersion('', '1.0', function (t) {
				t.executeSql('CREATE TABLE films (id, nom, geolocalisation)');
			}, error);
		});
		alert(db.version);
	}
	*/
	
	window.indexedDB = window.indexedDB || window.mozIndexedDB || window.webkitIndexedDB || window.msIndexedDB;
	window.IDBTransaction = window.IDBTransaction || window.webkitIDBTransaction || window.msIDBTransaction;
	window.IDBKeyRange = window.IDBKeyRange || window.webkitIDBKeyRange || window.msIDBKeyRange;
	
	var db;
	
	if (!window.indexedDB) {
    window.alert("Votre navigateur ne supporte pas une version stable d'IndexedDB. Quelques fonctionnalités ne seront pas disponibles.")
	}
	

	
const films = [];
const dbName = "MaBase";
	
var idbSupported = false;
var db;
 
document.addEventListener("DOMContentLoaded", function(){
 
    if("indexedDB" in window) {
        idbSupported = true;
    }
 
    if(idbSupported) {
        var openRequest = indexedDB.open("BaseFilms",1);
 
        openRequest.onupgradeneeded = function(e) {
			console.log("running onupgradeneeded");
			var thisDB = e.target.result;
		 
			if(!thisDB.objectStoreNames.contains("Films")) {
				thisDB.createObjectStore("Films");
			}
		}
 
        openRequest.onsuccess = function(e) {
            console.log("Success!");
            db = e.target.result;
        }
 
        openRequest.onerror = function(e) {
            console.log("Error");
            console.dir(e);
        }
 
    }
 
},false);

function ajoutFilm(f){
	console.log("appel de la fonction ajoutFilm avec le paramètre " + f);
	var e = {
		id : 0,
		nom : f
	}
	var transaction = db.transaction(["Films"],"readwrite");
    var store = transaction.objectStore("Films");
	var request = store.add(e,1);
}
	

    </script>
	<input id='nom' type='text'>
	<button onclick="ajoutFilm('nomDuFilm');">Ajout</button>
  </body>
</html>